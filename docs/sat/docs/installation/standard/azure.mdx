---
sidebar_position: 1
---
import useBaseUrl from '@docusaurus/useBaseUrl';
import Admonition from '@theme/Admonition';
import AccordionItem from '@site/src/components/AccordionItem';

# Azure Installation

This guide will walk you through setting up the **Security Analysis Tool (SAT)** on Azure Databricks.

<Admonition type="warning" title="Unity Catalog Required">
**SAT v0.5.0 and higher requires Unity Catalog.** Make sure Unity Catalog is enabled in your Databricks environment before installing SAT.
</Admonition>

<Admonition type="info" title="Azure Subscription">
SAT requires at least one SAT setup in a workspace per Azure **subscription**. One deployment can monitor all workspaces within the same subscription.
</Admonition>

<Admonition type="tip" title="Best for Premium & Enterprise Tiers">
SAT is especially beneficial to customers on Databricks **Premium** or **Enterprise** tiers, as most checks and recommendations involve security features only available in these tiers.
</Admonition>

## Prerequisites

Before you begin, ensure you have:

- âœ… Reviewed the [general prerequisites](../../installation/index.mdx#prerequisites)
- âœ… Appropriate permissions in your Azure cloud account
- âœ… A metastore attached to your installation workspace
- âœ… Databricks CLI installed and configured
- âœ… **Python version lower than 3.12** (for local installation using install.sh)

---

## Step 1: Create Azure App Registration

The App Registration allows SAT to authenticate with Azure services and Databricks.

<AccordionItem question="How to create an App Registration">

**Follow these steps in the Azure Portal:**

1. Open the Azure portal and navigate to **Microsoft Entra ID**
2. Click on `App registrations` â†’ `New registration`
3. Enter a name for the App Registration (e.g., "SAT-App")
4. Select the appropriate permissions (minimum requirement: single tenant access)
5. Click `Register`

<div className='bg-gray-100 p-4 rounded-lg mb-6'>
  <img src={useBaseUrl('/img/azure_app_reg.png')} alt="Azure App Registration" />
</div>

</AccordionItem>

---

## Step 2: Create Client Secret

<AccordionItem question="How to create an App Client Secret">

**After creating the App Registration:**

1. Open the App Registration you just created
2. Click on `Certificates & secrets` â†’ `New client secret`
3. Enter a description for the client secret
4. Select an expiry date
5. Click `Add`
6. **Copy and save the secret value immediately** (you won't be able to see it again!)
7. Add the app with "Reader" role to your subscription:
   - Navigate to your [subscription's Access control (IAM) section](https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-portal#step-2-open-the-add-role-assignment-page)
   - Click `Add role assignment`
   - Select the "Reader" role
   - Assign it to your App Registration

</AccordionItem>

---

## Step 3: Add Service Principal to Databricks

Now you'll connect your Azure App Registration to Databricks as a Service Principal.

<AccordionItem question="How to add the Service Principal">

**Follow these steps in Databricks Account Console:**

1. Navigate to the [Databricks Account Console](https://accounts.azuredatabricks.net/)
2. Click on `User management` in the left sidebar
3. Select `Service Principal` â†’ `Add service principal`
4. Paste the **App Client ID** (Application ID from Azure)
5. Create a name for the service principal
6. Click `Add`
7. Grant the `Account Admin` role
8. Assign the `Workspace Admin` role for each workspace to be monitored
9. Add to the `Metastore Admin` group or role

<div className='bg-gray-100 p-4 rounded-lg mb-6'>
  <img src={useBaseUrl('/img/azure_role_assignment.png')} alt="Role Assignment" />
</div>

**Required Permissions:**
- [Account Admin role](https://learn.microsoft.com/en-us/azure/databricks/admin/users-groups/service-principals#--assign-account-admin-roles-to-a-service-principal)
- [Workspace Admin role](https://learn.microsoft.com/en-us/azure/databricks/admin/users-groups/service-principals#assign-a-service-principal-to-a-workspace-using-the-account-console) for **each workspace**
- [Metastore admin group](https://learn.microsoft.com/en-us/azure/databricks/data-governance/unity-catalog/manage-privileges/admin-privileges#who-has-metastore-admin-privileges) membership

ðŸ“š [Learn more about Service Principals](https://learn.microsoft.com/en-us/azure/databricks/admin/users-groups/service-principals#--databricks-and-microsoft-entra-id-formerly-azure-active-directory-service-principals)

</AccordionItem>

---

## Step 4: Run Installation

<Admonition type="note" title="Credentials Required">
Have these credentials ready before starting:

- ðŸ”‘ **Databricks Account ID**
- ðŸ”‘ **Azure Tenant ID**
- ðŸ”‘ **Azure Subscription ID**
- ðŸ”‘ **Azure App Client ID** (from Step 1)
- ðŸ”‘ **Azure App Client Secret** (from Step 2)
</Admonition>

### Installation Steps

Run these commands on your workstation or a VM with internet access and Databricks workspace connectivity:

**1. Clone the SAT repository:**

```sh
git clone https://github.com/databricks-industry-solutions/security-analysis-tool.git
cd security-analysis-tool
```

<Admonition type="warning" title="Databricks CLI Required">
Make sure the target workspace has a [profile configured](https://docs.gcp.databricks.com/en/dev-tools/cli/profiles.html) in the [Databricks CLI](https://docs.gcp.databricks.com/en/dev-tools/cli/tutorial.html).
</Admonition>

**2. Make the installation script executable and run it:**

```sh
chmod +x install.sh
./install.sh
```

<Admonition type="tip" title="Proxy Support">
**Proxies are supported!** You can add your HTTP and HTTPS proxy values during the install.sh script when prompted.
</Admonition>

**3. Follow the interactive prompts:**

The installation script will guide you through the setup process. Here's what it looks like:

<div className='bg-gray-100 p-4 rounded-lg mb-6'>
  <img src={useBaseUrl('/gif/terminal-azure.gif')} alt="Installation Process" />
</div>

---

## Next Steps

Congratulations! You've successfully installed SAT on Azure Databricks.

<Admonition type="success" title="Installation Complete">
SAT is now ready to analyze your Databricks workspaces. Click [here](../../../functionality) for a detailed guide on how to run and use it.
</Admonition>

---

## Need Help?

<AccordionItem question="Troubleshooting Installation Issues">

If you encounter problems during installation:

**Common Issues:**
- âœ“ Double-check your credentials are correct
- âœ“ Verify you have the required permissions in your Azure and Databricks environments
- âœ“ Ensure the Service Principal has been added to all workspaces
- âœ“ Confirm the metastore is attached to your workspace
- âœ“ Verify the App Registration has the "Reader" role on your subscription

**Resources:**
- Review our [FAQ page](../../faq.mdx) for common questions
- Use the [diagnostic notebook](../../troubleshooting.mdx) to verify your setup
- Check the [troubleshooting guide](../../troubleshooting.mdx) for specific errors

**Still need help?** Contact us at sat@databricks.com

</AccordionItem>

---

## References

- [Azure App Registration](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)
- [Databricks Service Principals on Azure](https://learn.microsoft.com/en-us/azure/databricks/admin/users-groups/service-principals#--databricks-and-microsoft-entra-id-formerly-azure-active-directory-service-principals)
